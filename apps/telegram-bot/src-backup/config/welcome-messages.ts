// Default welcome messages for different languages
// These are used as fallback when no custom pack messages are configured

export const DEFAULT_WELCOME_MESSAGES = {
  en: `ğŸ‘‹ Hi {name}!

ğŸ¤– I'm Rad, your AI assistant that can help you manage Planka tasks and Rastar services right from Telegram.

ğŸ”§ Available Commands:

ğŸ“‹ Planka:
ğŸ”— /link_planka - Connect your Planka account
ğŸ“Š /planka_status - Check connection status
ğŸ”“ /planka_unlink - Disconnect account

ğŸ½ï¸ Rastar (Food Menu):
ğŸ”— /link_rastar - Connect your Rastar account  
ğŸ“Š /rastar_status - Check connection status
ğŸ”“ /rastar_unlink - Disconnect account

ğŸ’¬ AI Chat:
ğŸ’¬ /new_chat - Start a new conversation
ğŸ“š /history - View your chat sessions
ğŸ—‘ï¸ /clear_chat - Clear current conversation

ğŸ’¡ Getting Started:
Just send me a message to start chatting! I can help you with Planka tasks once you connect your account with /link_planka

âŒ¨ï¸ Quick Access: Use the buttons below to quickly access common features!`,

  fa: `ğŸ‘‹ Ø³Ù„Ø§Ù… {name}!

ğŸ¤– Ù…Ù† Ø±Ø¯ Ù‡Ø³ØªÙ…ØŒ Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø´Ù…Ø§ Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ø¨Ù‡ Ø´Ù…Ø§ Ø¯Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ù‡Ø§ÛŒ Ù¾Ù„Ø§Ù†Ú©Ø§ Ùˆ Ø®Ø¯Ù…Ø§Øª Ø±Ø³ØªØ§Ø± Ø§Ø² Ø·Ø±ÛŒÙ‚ ØªÙ„Ú¯Ø±Ø§Ù… Ú©Ù…Ú© Ú©Ù†Ù….

ğŸ”§ Ø¯Ø³ØªÙˆØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯:

ğŸ“‹ Ù¾Ù„Ø§Ù†Ú©Ø§:
ğŸ”— /link_planka - Ø§ØªØµØ§Ù„ Ø­Ø³Ø§Ø¨ Ù¾Ù„Ø§Ù†Ú©Ø§
ğŸ“Š /planka_status - Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„
ğŸ”“ /planka_unlink - Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Ø­Ø³Ø§Ø¨

ğŸ½ï¸ Ø±Ø³ØªØ§Ø± (Ù…Ù†ÙˆÛŒ ØºØ°Ø§):
ğŸ”— /link_rastar - Ø§ØªØµØ§Ù„ Ø­Ø³Ø§Ø¨ Ø±Ø³ØªØ§Ø±
ğŸ“Š /rastar_status - Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„
ğŸ”“ /rastar_unlink - Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Ø­Ø³Ø§Ø¨

ğŸ’¬ Ú¯ÙØªÚ¯ÙˆÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯:
ğŸ’¬ /new_chat - Ø´Ø±ÙˆØ¹ Ú¯ÙØªÚ¯ÙˆÛŒ Ø¬Ø¯ÛŒØ¯
ğŸ“š /history - Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú¯ÙØªÚ¯ÙˆÙ‡Ø§
ğŸ—‘ï¸ /clear_chat - Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú¯ÙØªÚ¯ÙˆÛŒ ÙØ¹Ù„ÛŒ

ğŸ’¡ Ø´Ø±ÙˆØ¹ Ú©Ø§Ø±:
ÙÙ‚Ø· ÛŒÙ‡ Ù¾ÛŒØ§Ù… Ø¨Ø±Ø§Ù… Ø¨ÙØ±Ø³Øª ØªØ§ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒÙ…! Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ø¨Ø¹Ø¯ Ø§Ø² Ø§ØªØµØ§Ù„ Ø­Ø³Ø§Ø¨ Ù¾Ù„Ø§Ù†Ú©Ø§ Ø¨Ø§ /link_planka Ø¨Ù‡Øª Ú©Ù…Ú© Ú©Ù†Ù….

âŒ¨ï¸ Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹: Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹ Ø¨Ù‡ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯!`,
} as const;

/**
 * Get welcome message from user's assigned pack or default pack
 */
export async function getWelcomeMessage(language: 'fa' | 'en' = 'en', telegramUserId?: string, userName?: string): Promise<string> {
  const { getPrisma } = await import('@rad/shared');
  
  try {
    const prisma = getPrisma();
    
    let packId: string | undefined;
    
    // Check if user has a custom pack assigned
    if (telegramUserId) {
      const assignment = await prisma.userPackAssignment.findUnique({
        where: { telegramUserId },
      });
      
      if (assignment) {
        packId = assignment.packId;
      }
    }
    
    // If no custom pack, find default pack
    if (!packId) {
      const defaultPack = await prisma.characterPack.findFirst({
        where: { isDefault: true },
      });
      
      if (defaultPack) {
        packId = defaultPack.id;
      }
    }
    
    // Fetch welcome message from the pack
    if (packId) {
      const message = await prisma.packMessage.findUnique({
        where: {
          packId_language_messageType: {
            packId,
            language,
            messageType: 'welcome',
          },
        },
      });
      
      if (message) {
        let content = message.content;
        if (userName) {
          content = content.replace(/\{name\}/g, userName);
        }
        return content;
      }
    }
    
    // Fallback to default welcome message
    let message: string = DEFAULT_WELCOME_MESSAGES[language];
    if (userName) {
      message = message.replace(/\{name\}/g, userName);
    }
    return message;
  } catch (error) {
    console.error('Error fetching welcome message from database:', error);
    let message: string = DEFAULT_WELCOME_MESSAGES[language];
    if (userName) {
      message = message.replace(/\{name\}/g, userName);
    }
    return message;
  }
}
