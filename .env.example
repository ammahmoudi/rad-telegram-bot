# ============================================================================
# RASTAR TELEGRAM BOT - ENVIRONMENT CONFIGURATION
# ============================================================================
# Copy this file to .env and fill in your values
# Generate secrets with: openssl rand -hex 32

# ============================================================================
# DEPLOYMENT CONFIGURATION
# ============================================================================
# Set to 'production' when deploying with Docker
NODE_ENV=development

# Default timezone for app date/time calculations (IANA name)
# Example: Asia/Tehran, Europe/Berlin, America/New_York
APP_TIMEZONE=Asia/Tehran

# Domain/URL Configuration (Update these for your deployment)
# Base domain for all services (used in production)
BASE_DOMAIN=your-domain.com

# Public URLs for each service (set these to your actual domains)
ADMIN_PANEL_URL=http://localhost:3000
LINK_PORTAL_URL=http://localhost:3002
MCP_PLANKA_URL=http://localhost:3100/mcp
MCP_RASTAR_URL=http://localhost:3101/mcp
MCP_TIME_URL=http://localhost:3102/mcp

# ============================================================================
# TELEGRAM BOT CONFIGURATION
# ============================================================================
# Get your bot token from @BotFather on Telegram
TELEGRAM_BOT_TOKEN=

# Optional: Telegram bot username (used for @mentions)
TELEGRAM_BOT_USERNAME=

# Chat mode: 'thread' or 'simple'
# - thread: Uses Telegram's threaded mode (topics) for separate conversations
# - simple: All chats in main private chat, no threads/topics
CHAT_MODE=thread

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# SQLite database path (for development without Docker)
DATABASE_PATH=./data/rastar.db

# Database URL (for production with Docker)
# SQLite: file:/app/data/rastar.db
# PostgreSQL: postgresql://user:password@postgres:5432/rastar
DATABASE_URL=file:./data/rastar.db

# ============================================================================
# REDIS (for BullMQ scheduled jobs)
# ============================================================================
# Redis connection for job queue (BullMQ)
# Local Docker: redis://localhost:6379
# Production Docker: redis://redis:6379
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_URL=redis://localhost:6379

# ============================================================================
# SECURITY & ENCRYPTION
# ============================================================================
# Encryption key for storing sensitive user data (tokens, passwords)
# Generate with: openssl rand -hex 32
ENCRYPTION_KEY=

# NextAuth secret for admin panel authentication
# Generate with: openssl rand -base64 32
NEXTAUTH_SECRET=

# Admin panel URL (for NextAuth callbacks)
NEXTAUTH_URL=http://localhost:3000

# Optional: Default admin credentials (created automatically on Docker startup)
# Leave empty to skip automatic admin creation
DEFAULT_ADMIN_USERNAME=
DEFAULT_ADMIN_PASSWORD=

# ============================================================================
# AI CONFIGURATION (OpenRouter)
# ============================================================================
# OpenRouter API key for AI chat functionality
# Get your key from: https://openrouter.ai/keys
OPENROUTER_API_KEY=

# Default AI model for chat
# Popular options:
#   - anthropic/claude-3.5-sonnet (recommended, best for reasoning)
#   - openai/gpt-4o (very capable, multimodal)
#   - google/gemini-flash-1.5 (fast and cost-effective)
#   - meta-llama/llama-3.1-70b-instruct (open source)
# See all models: https://openrouter.ai/models
DEFAULT_AI_MODEL=anthropic/claude-3.5-sonnet

# ============================================================================
# MCP SERVER CONFIGURATION
# ============================================================================
# Transport mode for MCP servers (http or stdio)
# In production with Docker, this is automatically set to 'http'
MCP_TRANSPORT=stdio

# MCP Server Ports (only needed if running standalone)
MCP_PLANKA_PORT=3100
MCP_RASTAR_PORT=3101
MCP_TIME_PORT=3102

# Allowed hosts for MCP servers (comma-separated, REQUIRED for external access)
# Only Docker service names are allowed by default (mcp-rastar, mcp-planka)
# Add localhost for local testing, and production domains for deployment
# Examples:
#   Local: ALLOWED_HOSTS=localhost,127.0.0.1
#   Production: ALLOWED_HOSTS=rastar-mcp.rastar.dev,planka-mcp.rastar.dev
ALLOWED_HOSTS=localhost,127.0.0.1

# ============================================================================
# PLANKA INTEGRATION (via MCP)
# ============================================================================
# Planka server URL (your Planka instance)
PLANKA_SERVER_URL=https://planka.your-domain.com

# Daily Report Project Category ID (optional)
# If set, daily report tools will filter by this category instead of by project name
# You can find category IDs in Planka or set via Admin Panel Settings
PLANKA_DAILY_REPORT_CATEGORY_ID=

# ============================================================================
# SERVICE PORTS (OPTIONAL OVERRIDES)
# ============================================================================
# Each service has a default port. Override only if you need different ports.
# Default ports:
#   - Admin Panel: 3000
#   - Telegram Bot: 3001 (health check server)
#   - Link Portal: 3002
#   - MCP Planka: 3100
#   - MCP Rastar: 3101

# ADMIN_PANEL_PORT=3000
# TELEGRAM_BOT_PORT=3001
# LINK_PORTAL_PORT=3002
# MCP_PLANKA_PORT=3100
# MCP_RASTAR_PORT=3101
# MCP_TIME_PORT=3102

# Host binding (set to 0.0.0.0 for Docker/production, localhost for local dev)
HOSTNAME=0.0.0.0
HOST=0.0.0.0

# Note: User-specific Planka tokens are stored in the database
# Users will authenticate via the Telegram bot using /link_planka

# ============================================================================
# RASTAR API INTEGRATION (Company Food Ordering System - my.rastar.company)
# ============================================================================
# Supabase backend URL (Do not change unless using custom backend)
RASTAR_SUPABASE_URL=https://hhryfmueyrkbnjxgjzlf.supabase.co

# Supabase authentication endpoint (Do not change)
RASTAR_SUPABASE_AUTH_PATH=/auth/v1/token

# Supabase anon key - Public key for client authentication
# This is safe to commit - it's meant to be public
RASTAR_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhocnlmbXVleXJrYm5qeGdqemxmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5MDMwMDYsImV4cCI6MjA1NTQ3OTAwNn0.zB6aDG8aTVqXkyguz1u35rGYlz05bDy20d5GXjhxirU

# Header name for API key (Do not change)
RASTAR_SUPABASE_KEY_HEADER=apikey

# ⚠️ IMPORTANT: No username/password needed in env files!
# Users authenticate individually via /link_rastar command in the Telegram bot
# Their credentials are stored encrypted in the database

# ============================================================================
# SERVICE PORTS (for Docker deployment)
# ============================================================================
# These can be changed if you have port conflicts
TELEGRAM_BOT_PORT=3001
LINK_PORTAL_PORT=3002
ADMIN_PANEL_PORT=3000

# ============================================================================
# OPTIONAL: EXTERNAL DATABASE (PostgreSQL)
# ============================================================================
# Uncomment and configure if migrating from SQLite to PostgreSQL
# POSTGRES_HOST=postgres
# POSTGRES_PORT=5432
# POSTGRES_DB=rastar
# POSTGRES_USER=rastar_user
# POSTGRES_PASSWORD=
# DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# ============================================================================
# OPTIONAL: REVERSE PROXY / SSL
# ============================================================================
# If using a reverse proxy (Nginx, Caddy, Traefik)
# USE_SSL=true
# SSL_CERT_PATH=/etc/ssl/certs/cert.pem
# SSL_KEY_PATH=/etc/ssl/private/key.pem

# ============================================================================
# OPTIONAL: MONITORING & LOGGING
# ============================================================================
# Log level (error, warn, info, debug)
LOG_LEVEL=info

# Enable detailed logging
DEBUG=false

# ============================================================================
# OPTIONAL: RATE LIMITING
# ============================================================================
# Rate limit for API endpoints (requests per minute)
RATE_LIMIT_PER_MINUTE=60

# ============================================================================
# DOCKER-SPECIFIC (automatically set in containers)
# ============================================================================
# These are set automatically by docker-compose.yml, no need to configure
# - PORT (for each service)
# - NEXT_TELEMETRY_DISABLED=1

# ============================================================================
# Rastar Supabase Integration
# ============================================================================
RASTAR_SUPABASE_URL=https://hhryfmueyrkbnjxgjzlf.supabase.co
RASTAR_SUPABASE_ANON_KEY=your_supabase_anon_key
RASTAR_SUPABASE_AUTH_PATH=/auth/v1/token
RASTAR_SUPABASE_KEY_HEADER=apikey

# ============================================================================
# Database & Security
# ============================================================================
